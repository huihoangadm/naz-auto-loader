window.__NAZ_PAYLOAD="Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBOQVogQVVUTyBWMS4wLjAgXHUyMDE0IEV4cGVjdGltYXggKyBTbmFrZS1Db3JuZXIgQWRhcHRpdmUgKE1lcmdlZCkKLy8gQG5hbWVzcGFjZSAgICBodHRwOi8vdGFtcGVybW9ua2V5Lm5ldC8KLy8gQHZlcnNpb24gICAgICAxLjIKLy8gQGRlc2NyaXB0aW9uICBNZXJnZWQ6IFVsdHJhIDIwNDggQUkgKyBDeWJlcnB1bmsgVUkgKEZQUyArIEV2YWwgY2hhcnQpLiBQYXN0ZSB0byBDb25zb2xlIG9yIGluc3RhbGwgYXMgdXNlcnNjcmlwdC4KLy8gQG1hdGNoICAgICAgICA6Ly8vMjA0OC8qCi8vIEBtYXRjaCAgICAgICAgOi8vZXZlbnQudm5nZ2FtZXMuY29tLwovLyBAZ3JhbnQgICAgICAgIG5vbmUKLy8gPT0vVXNlclNjcmlwdD09CgooKCkgPT4gewppZiAod2luZG93Lk5BWl9BVVRPX0xPQURFRCkgewogICAgY29uc29sZS5sb2coIk5BWiBBVVRPIGFscmVhZHkgbG9hZGVkIik7CiAgICByZXR1cm47Cn0Kd2luZG93Lk5BWl9BVVRPX0xPQURFRCA9IHRydWU7CgovKiAtLS0tLS0tLS0tIENPTkZJRyAtLS0tLS0tLS0tICovCmNvbnN0IEdSSUQgPSA0OwpsZXQgREVGQVVMVFMgPSB7CiAgICBkZXB0aDogMywKICAgIG1heERlcHRoOiA1LAogICAgbW92ZUludGVydmFsOiAxMjAsCiAgICB0aW1lUGVyTW92ZTogMzAwLAogICAgc25ha2VXZWlnaHRGYWN0b3I6IDIyMDAsCiAgICBjaGFuY2VTYW1wbGVUaHJlc2hvbGQ6IDYsCiAgICBjaGFuY2VTYW1wbGVDb3VudDogNiwKICAgIHJhbmRvbW5lc3M6IDAuMDYsCiAgICBhdXRvUmVzdGFydDogdHJ1ZQp9OwoKLyogLS0tLS0tLS0tLSBHTE9CQUwgU1RBVFVTIChmb3IgVUkpIC0tLS0tLS0tLS0gKi8Kd2luZG93Lmxhc3RNb3ZlID0gbnVsbDsKd2luZG93Lmxhc3RFdmFsU2NvcmUgPSBudWxsOwoKLyogLS0tLS0tLS0tLSBVVElMICYgQk9BUkQgSS9PIC0tLS0tLS0tLS0gKi8KZnVuY3Rpb24gY2xvbmVCb2FyZChiKSB7IHJldHVybiBiLm1hcChyID0+IHIuc2xpY2UoKSk7IH0KZnVuY3Rpb24gYm9hcmRUb0tleShiKSB7IHJldHVybiBiLmZsYXQoKS5tYXAoeD0+eHx8MCkuam9pbignLCcpOyB9CmZ1bmN0aW9uIGdldEVtcHR5Q2VsbHMoYikgewogICAgY29uc3QgZSA9IFtdOwogICAgZm9yIChsZXQgcj0wO3I8R1JJRDtyKyspIGZvciAobGV0IGM9MDtjPEdSSUQ7YysrKSBpZiAoIWJbcl1bY10pIGUucHVzaChbcixjXSk7CiAgICByZXR1cm4gZTsKfQoKLy8gVHJ5IHRvIHJlYWQgYm9hcmQgZnJvbSBET00gdGlsZXMgKGJlc3QtZWZmb3J0KS4gSWYgcmV0dXJucyBhbGwtbnVsbCAtPiBmYWxsYmFjayB0byBrZXlwcmVzcy1vbmx5IG1vZGUuCmZ1bmN0aW9uIHJlYWRCb2FyZEZyb21ET00odGlsZVB4R3Vlc3M9MTQ3KSB7CiAgICBjb25zdCBib2FyZCA9IEFycmF5LmZyb20oe2xlbmd0aDpHUklEfSwoKT0+QXJyYXkoR1JJRCkuZmlsbChudWxsKSk7CiAgICAvLyB0cnkgY29tbW9uIHNlbGVjdG9ycwogICAgY29uc3QgdGlsZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZ3JpZCAudGlsZSwgLnRpbGUsIC50aWxlLWlubmVyLCAudGlsZS1jb250YWluZXIgLnRpbGUnKTsKICAgIGlmICghdGlsZXMgfHwgdGlsZXMubGVuZ3RoID09PSAwKSByZXR1cm4gYm9hcmQuZmxhdCgpLmV2ZXJ5KHY9PnY9PT1udWxsKSA/IGJvYXJkIDogYm9hcmQ7CiAgICB0aWxlcy5mb3JFYWNoKHQgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxldCBsZWZ0PTAsIHRvcD0wOwogICAgICAgICAgICBjb25zdCBzdHlsZSA9IHQuc3R5bGUgfHwgd2luZG93LmdldENvbXB1dGVkU3R5bGUodCk7CiAgICAgICAgICAgIGNvbnN0IHRyYW5zZm9ybSA9IHN0eWxlLnRyYW5zZm9ybSB8fCBzdHlsZS53ZWJraXRUcmFuc2Zvcm07CiAgICAgICAgICAgIGlmICh0cmFuc2Zvcm0gJiYgdHJhbnNmb3JtICE9PSAnbm9uZScpIHsKICAgICAgICAgICAgICAgIC8vIGJlc3QtZWZmb3J0IHBhcnNlIChvbGQgc2NyaXB0cyBzb21ldGltZXMgdXNlIHRyYW5zZm9ybXMpCiAgICAgICAgICAgICAgICBjb25zdCBtID0gL3RyYW5zbGF0ZS4qP1woXHMqKFstXGQuXSspcHgsXHMqKFstXGQuXSspcHgvLmV4ZWModHJhbnNmb3JtKTsKICAgICAgICAgICAgICAgIGlmIChtKSB7IGxlZnQgPSBwYXJzZUZsb2F0KG1bMV0pfHwwOyB0b3AgPSBwYXJzZUZsb2F0KG1bMl0pfHwwOyB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBsID0gdC5zdHlsZS5sZWZ0IHx8ICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0KS5sZWZ0KSB8fCAnMHB4JzsKICAgICAgICAgICAgICAgIGNvbnN0IHR0ID0gdC5zdHlsZS50b3AgfHwgKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHQpLnRvcCkgfHwgJzBweCc7CiAgICAgICAgICAgICAgICBsZWZ0ID0gcGFyc2VGbG9hdChTdHJpbmcobCkucmVwbGFjZSgncHgnLCcnKSl8fDA7CiAgICAgICAgICAgICAgICB0b3AgPSBwYXJzZUZsb2F0KFN0cmluZyh0dCkucmVwbGFjZSgncHgnLCcnKSl8fDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgciA9IE1hdGgucm91bmQodG9wIC8gdGlsZVB4R3Vlc3MpOwogICAgICAgICAgICBjb25zdCBjID0gTWF0aC5yb3VuZChsZWZ0IC8gdGlsZVB4R3Vlc3MpOwogICAgICAgICAgICBjb25zdCB0ZXh0ID0gKHQudGV4dENvbnRlbnR8fCcnKS50cmltKCk7CiAgICAgICAgICAgIGNvbnN0IHZhbCA9IHBhcnNlSW50KHRleHQsMTApOwogICAgICAgICAgICBpZiAoIWlzTmFOKHZhbCkgJiYgcj49MCAmJiByPEdSSUQgJiYgYz49MCAmJiBjPEdSSUQpIGJvYXJkW3JdW2NdID0gdmFsOwogICAgICAgIH0gY2F0Y2goZSl7fQogICAgfSk7CiAgICByZXR1cm4gYm9hcmQ7Cn0KCi8qIC0tLS0tLS0tLS0gTU9WRSBTSU0gLS0tLS0tLS0tLSAqLwpmdW5jdGlvbiBzbGlkZVJvd1ZhbHVlcyhyb3cpIHsKICAgIGNvbnN0IGFyciA9IHJvdy5maWx0ZXIoeD0+eCE9bnVsbCk7CiAgICBjb25zdCBvdXQgPSBbXTsKICAgIGZvciAobGV0IGk9MDtpPGFyci5sZW5ndGg7aSsrKXsKICAgICAgICBpZiAoaSsxIDwgYXJyLmxlbmd0aCAmJiBhcnJbaV0gPT09IGFycltpKzFdKSB7IG91dC5wdXNoKGFycltpXSoyKTsgaSsrOyB9CiAgICAgICAgZWxzZSBvdXQucHVzaChhcnJbaV0pOwogICAgfQogICAgd2hpbGUgKG91dC5sZW5ndGggPCBHUklEKSBvdXQucHVzaChudWxsKTsKICAgIHJldHVybiBvdXQ7Cn0KZnVuY3Rpb24gbW92ZU9uKGJvYXJkLCBkaXIpIHsKICAgIGNvbnN0IGIgPSBjbG9uZUJvYXJkKGJvYXJkKTsKICAgIGxldCBtb3ZlZD1mYWxzZTsKICAgIGlmIChkaXI9PT0nbGVmdCcgfHwgZGlyPT09J3JpZ2h0JykgewogICAgICAgIGZvciAobGV0IHI9MDtyPEdSSUQ7cisrKXsKICAgICAgICAgICAgbGV0IHJvdyA9IGJbcl0uc2xpY2UoKTsKICAgICAgICAgICAgaWYgKGRpcj09PSdyaWdodCcpIHJvdyA9IHJvdy5zbGljZSgpLnJldmVyc2UoKTsKICAgICAgICAgICAgY29uc3QgbmV3Um93ID0gc2xpZGVSb3dWYWx1ZXMocm93KTsKICAgICAgICAgICAgY29uc3QgZmluYWxSb3cgPSBkaXI9PT0ncmlnaHQnID8gbmV3Um93LnNsaWNlKCkucmV2ZXJzZSgpIDogbmV3Um93OwogICAgICAgICAgICBmb3IgKGxldCBjPTA7YzxHUklEO2MrKyl7IGlmIChiW3JdW2NdICE9PSBmaW5hbFJvd1tjXSkgbW92ZWQ9dHJ1ZTsgYltyXVtjXT1maW5hbFJvd1tjXTsgfQogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChsZXQgYz0wO2M8R1JJRDtjKyspewogICAgICAgICAgICBsZXQgY29sPVtdOwogICAgICAgICAgICBmb3IgKGxldCByPTA7cjxHUklEO3IrKykgY29sLnB1c2goYltyXVtjXXx8bnVsbCk7CiAgICAgICAgICAgIGlmIChkaXI9PT0nZG93bicpIGNvbCA9IGNvbC5zbGljZSgpLnJldmVyc2UoKTsKICAgICAgICAgICAgY29uc3QgbmV3Q29sID0gc2xpZGVSb3dWYWx1ZXMoY29sKTsKICAgICAgICAgICAgY29uc3QgZmluYWxDb2wgPSBkaXI9PT0nZG93bicgPyBuZXdDb2wuc2xpY2UoKS5yZXZlcnNlKCkgOiBuZXdDb2w7CiAgICAgICAgICAgIGZvciAobGV0IHI9MDtyPEdSSUQ7cisrKXsgaWYgKGJbcl1bY10hPT1maW5hbENvbFtyXSkgbW92ZWQ9dHJ1ZTsgYltyXVtjXT1maW5hbENvbFtyXTsgfQogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGJvYXJkOiBiLCBtb3ZlZCB9Owp9CgovKiAtLS0tLS0tLS0tIEhFVVJJU1RJQ1MgKFNOQUtFLUNPUk5FUiBWMykgLS0tLS0tLS0tLSAqLwpjb25zdCBsb2cyQ2FjaGUgPSBuZXcgTWFwKCk7CmZ1bmN0aW9uIGxvZzJDYWNoZWQoeCl7IGlmKCF4KSByZXR1cm4gMDsgaWYgKGxvZzJDYWNoZS5oYXMoeCkpIHJldHVybiBsb2cyQ2FjaGUuZ2V0KHgpOyBjb25zdCB2PU1hdGgubG9nMih4KTsgbG9nMkNhY2hlLnNldCh4LHYpOyByZXR1cm4gdjsgfQoKZnVuY3Rpb24gbWFrZVNuYWtlV2VpZ2h0cyhjb3JuZXI9J2JyJykgewogICAgY29uc3Qgb3JkZXJzID0gewogICAgICAgIHRsOiBbWzAsMF0sWzAsMV0sWzAsMl0sWzAsM10sWzEsM10sWzEsMl0sWzEsMV0sWzEsMF0sWzIsMF0sWzIsMV0sWzIsMl0sWzIsM10sWzMsM10sWzMsMl0sWzMsMV0sWzMsMF1dLAogICAgICAgIHRyOiBbWzAsM10sWzAsMl0sWzAsMV0sWzAsMF0sWzEsMF0sWzEsMV0sWzEsMl0sWzEsM10sWzIsM10sWzIsMl0sWzIsMV0sWzIsMF0sWzMsMF0sWzMsMV0sWzMsMl0sWzMsM11dLAogICAgICAgIGJyOiBbWzMsM10sWzMsMl0sWzMsMV0sWzMsMF0sWzIsMF0sWzIsMV0sWzIsMl0sWzIsM10sWzEsM10sWzEsMl0sWzEsMV0sWzEsMF0sWzAsMF0sWzAsMV0sWzAsMl0sWzAsM11dLAogICAgICAgIGJsOiBbWzMsMF0sWzMsMV0sWzMsMl0sWzMsM10sWzIsM10sWzIsMl0sWzIsMV0sWzIsMF0sWzEsMF0sWzEsMV0sWzEsMl0sWzEsM10sWzAsM10sWzAsMl0sWzAsMV0sWzAsMF1dCiAgICB9OwogICAgY29uc3Qgb3JkID0gb3JkZXJzW2Nvcm5lcl0gfHwgb3JkZXJzLmJyOwogICAgY29uc3QgdyA9IEFycmF5LmZyb20oe2xlbmd0aDpHUklEfSwoKT0+QXJyYXkoR1JJRCkuZmlsbCgwKSk7CiAgICBmb3IgKGxldCBpPTA7aTxvcmQubGVuZ3RoO2krKyl7CiAgICAgICAgY29uc3QgW3IsY109b3JkW2ldOwogICAgICAgIHdbcl1bY10gPSBNYXRoLnBvdygxLjE1LCBvcmQubGVuZ3RoIC0gaSk7CiAgICB9CiAgICByZXR1cm4gdzsKfQoKZnVuY3Rpb24gbW9ub3RvbmljaXR5U2NvcmUoYm9hcmQpewogICAgbGV0IHNjb3JlPTA7CiAgICBmb3IgKGxldCByPTA7cjxHUklEO3IrKyl7CiAgICAgICAgbGV0IGluYz0wLCBkZWM9MDsKICAgICAgICBmb3IgKGxldCBjPTA7YzxHUklELTE7YysrKXsgY29uc3QgYT1ib2FyZFtyXVtjXXx8MCwgYj1ib2FyZFtyXVtjKzFdfHwwOyBpZiAoYTxiKSBpbmMgKz0gYi1hOyBlbHNlIGRlYyArPSBhLWI7IH0KICAgICAgICBzY29yZSAtPSBNYXRoLm1heChpbmMsZGVjKTsKICAgIH0KICAgIGZvciAobGV0IGM9MDtjPEdSSUQ7YysrKXsKICAgICAgICBsZXQgaW5jPTAsIGRlYz0wOwogICAgICAgIGZvciAobGV0IHI9MDtyPEdSSUQtMTtyKyspeyBjb25zdCBhPWJvYXJkW3JdW2NdfHwwLCBiPWJvYXJkW3IrMV1bY118fDA7IGlmIChhPGIpIGluYys9Yi1hOyBlbHNlIGRlYys9YS1iOyB9CiAgICAgICAgc2NvcmUgLT0gTWF0aC5tYXgoaW5jLGRlYyk7CiAgICB9CiAgICByZXR1cm4gc2NvcmU7Cn0KCmZ1bmN0aW9uIHNtb290aG5lc3NTY29yZShib2FyZCl7CiAgICBsZXQgcz0wOwogICAgZm9yIChsZXQgcj0wO3I8R1JJRDtyKyspIGZvciAobGV0IGM9MDtjPEdSSUQ7YysrKXsKICAgICAgICBjb25zdCB2PWJvYXJkW3JdW2NdOyBpZighdikgY29udGludWU7IGNvbnN0IGx2PWxvZzJDYWNoZWQodik7CiAgICAgICAgaWYgKGMrMTxHUklEICYmIGJvYXJkW3JdW2MrMV0pIHMgLT0gTWF0aC5hYnMobG9nMkNhY2hlZChib2FyZFtyXVtjKzFdKSAtIGx2KTsKICAgICAgICBpZiAocisxPEdSSUQgJiYgYm9hcmRbcisxXVtjXSkgcyAtPSBNYXRoLmFicyhsb2cyQ2FjaGVkKGJvYXJkW3IrMV1bY10pIC0gbHYpOwogICAgfQogICAgcmV0dXJuIHM7Cn0KCmZ1bmN0aW9uIGRldGVjdFByZWZlcnJlZENvcm5lcihib2FyZCl7CiAgICBsZXQgbWF4PTAsIHBvcz1bMCwwXTsKICAgIGZvciAobGV0IHI9MDtyPEdSSUQ7cisrKSBmb3IgKGxldCBjPTA7YzxHUklEO2MrKykgaWYgKGJvYXJkW3JdW2NdICYmIGJvYXJkW3JdW2NdID4gbWF4KSB7IG1heD1ib2FyZFtyXVtjXTsgcG9zPVtyLGNdOyB9CiAgICBjb25zdCBbcixjXSA9IHBvczsKICAgIGNvbnN0IGNvcm5lcnMgPSB7IHRsOlswLDBdLCB0cjpbMCxHUklELTFdLCBicjpbR1JJRC0xLEdSSUQtMV0sIGJsOltHUklELTEsMF0gfTsKICAgIGxldCBiZXN0PSdicicsIGJlc3RkPTFlOTsKICAgIGZvciAoY29uc3QgayBpbiBjb3JuZXJzKXsKICAgICAgICBjb25zdCBbY3IsY2NdPWNvcm5lcnNba107CiAgICAgICAgY29uc3QgZCA9IE1hdGguYWJzKGNyIC0gcikgKyBNYXRoLmFicyhjYyAtIGMpOwogICAgICAgIGlmIChkIDwgYmVzdGQpIHsgYmVzdGQgPSBkOyBiZXN0ID0gazsgfQogICAgfQogICAgcmV0dXJuIGJlc3Q7Cn0KCmZ1bmN0aW9uIHNuYWtlU2NvcmUoYm9hcmQsIHdlaWdodHMpIHsKICAgIGxldCBzPTA7CiAgICBmb3IgKGxldCByPTA7cjxHUklEO3IrKykgZm9yIChsZXQgYz0wO2M8R1JJRDtjKyspewogICAgICAgIGNvbnN0IHYgPSBib2FyZFtyXVtjXTsgaWYoIXYpIGNvbnRpbnVlOyBzICs9IGxvZzJDYWNoZWQodikgKiAod2VpZ2h0c1tyXVtjXXx8MCk7CiAgICB9CiAgICByZXR1cm4gczsKfQoKLy8gLS0tLS0tLS0tLSBIRVVSSVNUSUMgLS0tLS0tLS0tLQpmdW5jdGlvbiBoZXVyaXN0aWMoYm9hcmQsIG9wdHMgPSB7fSkgewogICAgY29uc3Qgc25ha2VXZWlnaHRzID0gb3B0cy5zbmFrZVdlaWdodHM7CiAgICBjb25zdCBzbmFrZVdlaWdodEZhY3RvciA9IG9wdHMuc25ha2VXZWlnaHRGYWN0b3IgfHwgMTQwMDsKCiAgICBsZXQgZW1wdGllcyA9IDAsIG1heFRpbGUgPSAwOwogICAgZm9yIChsZXQgciA9IDA7IHIgPCBHUklEOyByKyspIHsKICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IEdSSUQ7IGMrKykgewogICAgICAgICAgICBjb25zdCB2ID0gYm9hcmRbcl1bY107CiAgICAgICAgICAgIGlmICghdikgZW1wdGllcysrOwogICAgICAgICAgICBlbHNlIGlmICh2ID4gbWF4VGlsZSkgbWF4VGlsZSA9IHY7CiAgICAgICAgfQogICAgfQoKICAgIGxldCBtb25vID0gMDsKICAgIGZvciAobGV0IHIgPSAwOyByIDwgR1JJRDsgcisrKSB7CiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBHUklEIC0gMTsgYysrKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSBib2FyZFtyXVtjXSB8fCAwOwogICAgICAgICAgICBjb25zdCBiID0gYm9hcmRbcl1bYyArIDFdIHx8IDA7CiAgICAgICAgICAgIG1vbm8gLT0gTWF0aC5hYnMobG9nMkNhY2hlZChhKSAtIGxvZzJDYWNoZWQoYikpOwogICAgICAgIH0KICAgIH0KICAgIGZvciAobGV0IGMgPSAwOyBjIDwgR1JJRDsgYysrKSB7CiAgICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCBHUklEIC0gMTsgcisrKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSBib2FyZFtyXVtjXSB8fCAwOwogICAgICAgICAgICBjb25zdCBiID0gYm9hcmRbciArIDFdW2NdIHx8IDA7CiAgICAgICAgICAgIG1vbm8gLT0gTWF0aC5hYnMobG9nMkNhY2hlZChhKSAtIGxvZzJDYWNoZWQoYikpOwogICAgICAgIH0KICAgIH0KCiAgICBsZXQgc21vb3RoID0gMDsKICAgIGZvciAobGV0IHIgPSAwOyByIDwgR1JJRDsgcisrKSB7CiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBHUklEOyBjKyspIHsKICAgICAgICAgICAgY29uc3QgdiA9IGJvYXJkW3JdW2NdOwogICAgICAgICAgICBpZiAoIXYpIGNvbnRpbnVlOwogICAgICAgICAgICBjb25zdCBsdiA9IGxvZzJDYWNoZWQodik7CiAgICAgICAgICAgIGlmIChjICsgMSA8IEdSSUQgJiYgYm9hcmRbcl1bYyArIDFdKQogICAgICAgICAgICAgICAgc21vb3RoIC09IE1hdGguYWJzKGxvZzJDYWNoZWQoYm9hcmRbcl1bYyArIDFdKSAtIGx2KTsKICAgICAgICAgICAgaWYgKHIgKyAxIDwgR1JJRCAmJiBib2FyZFtyICsgMV1bY10pCiAgICAgICAgICAgICAgICBzbW9vdGggLT0gTWF0aC5hYnMobG9nMkNhY2hlZChib2FyZFtyICsgMV1bY10pIC0gbHYpOwogICAgICAgIH0KICAgIH0KCiAgICBsZXQgc25ha2VTY29yZVZhbHVlID0gMDsKICAgIGlmIChzbmFrZVdlaWdodHMpIHsKICAgICAgICBmb3IgKGxldCByID0gMDsgciA8IEdSSUQ7IHIrKykgewogICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IEdSSUQ7IGMrKykgewogICAgICAgICAgICAgICAgY29uc3QgdiA9IGJvYXJkW3JdW2NdOwogICAgICAgICAgICAgICAgaWYgKCF2KSBjb250aW51ZTsKICAgICAgICAgICAgICAgIHNuYWtlU2NvcmVWYWx1ZSArPSBsb2cyQ2FjaGVkKHYpICogc25ha2VXZWlnaHRzW3JdW2NdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGxldCBjb3JuZXJCb251cyA9IDA7CiAgICBpZiAoc25ha2VXZWlnaHRzKSB7CiAgICAgICAgbGV0IGJlc3RXID0gMCwgYmVzdFBvcyA9IFswLCAwXTsKICAgICAgICBmb3IgKGxldCByID0gMDsgciA8IEdSSUQ7IHIrKykKICAgICAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBHUklEOyBjKyspCiAgICAgICAgICAgICAgICBpZiAoKHNuYWtlV2VpZ2h0c1tyXVtjXSB8fCAwKSA+IGJlc3RXKSB7IGJlc3RXID0gc25ha2VXZWlnaHRzW3JdW2NdOyBiZXN0UG9zID0gW3IsIGNdOyB9CiAgICAgICAgY29uc3QgW2NyLCBjY10gPSBiZXN0UG9zOwogICAgICAgIGNvbnN0IHRpbGVBdENvcm5lciA9IGJvYXJkW2NyXVtjY10gfHwgMDsKICAgICAgICBpZiAodGlsZUF0Q29ybmVyID09PSBtYXhUaWxlICYmIG1heFRpbGUgPiAwKSBjb3JuZXJCb251cyA9IGxvZzJDYWNoZWQobWF4VGlsZSkgKiA2MDA7CiAgICAgICAgZWxzZSBjb3JuZXJCb251cyA9IC1sb2cyQ2FjaGVkKG1heFRpbGUgfHwgMSkgKiA4MDA7CiAgICB9CgogICAgY29uc3QgZW1wdHlCb251cyA9IGVtcHRpZXMgKiAxNTAwOwoKICAgIHJldHVybiAoCiAgICAgICAgZW1wdHlCb251cyArCiAgICAgICAgbW9ubyAqIDUwICsKICAgICAgICBzbW9vdGggKiAyMiArCiAgICAgICAgc25ha2VTY29yZVZhbHVlICogKHNuYWtlV2VpZ2h0RmFjdG9yIC8gMTUwMCkgKwogICAgICAgIGNvcm5lckJvbnVzCiAgICApOwp9CgovKiAtLS0tLS0tLS0tIEVYUEVDVElNQVggd2l0aCBUVCAmIHNhbXBsaW5nICYgaXRlcmF0aXZlIGRlZXBlbmluZyAtLS0tLS0tLS0tICovCmNvbnN0IE1PVkVTID0gWyd1cCcsJ3JpZ2h0JywnZG93bicsJ2xlZnQnXTsKY29uc3QgVFQgPSBuZXcgTWFwKCk7CgpmdW5jdGlvbiBzYW1wbGVFbXB0aWVzKGVtcHRpZXMsIGNvdW50LCBib2FyZCwgaGV1cmlzdGljRm4pewogICAgY29uc3Qgc2NvcmVkPVtdOwogICAgZm9yIChsZXQgaT0wO2k8ZW1wdGllcy5sZW5ndGg7aSsrKXsKICAgICAgICBjb25zdCBbcixjXT1lbXB0aWVzW2ldOwogICAgICAgIGJvYXJkW3JdW2NdPTI7CiAgICAgICAgY29uc3Qgc2MgPSBoZXVyaXN0aWNGbihib2FyZCk7CiAgICAgICAgYm9hcmRbcl1bY109bnVsbDsKICAgICAgICBzY29yZWQucHVzaCh7aSxzY30pOwogICAgfQogICAgc2NvcmVkLnNvcnQoKGEsYik9PmIuc2MtYS5zYyk7CiAgICBjb25zdCByZXM9W107CiAgICBmb3IgKGxldCBpPTA7aTxNYXRoLm1pbihjb3VudCwgc2NvcmVkLmxlbmd0aCk7IGkrKykgcmVzLnB1c2goZW1wdGllc1tzY29yZWRbaV0uaV0pOwogICAgcmV0dXJuIHJlczsKfQoKZnVuY3Rpb24gZXhwZWN0aW1heChib2FyZCwgZGVwdGgsIGlzQ2hhbmNlLCB0c3RhcnQsIHRpbWVCdWRnZXRNcywgc25ha2VXZWlnaHRzLCBzbmFrZVdlaWdodEZhY3Rvcil7CiAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0c3RhcnQgPiB0aW1lQnVkZ2V0TXMpIHJldHVybiBudWxsOwogICAgY29uc3QgZW1wdGllcyA9IGdldEVtcHR5Q2VsbHMoYm9hcmQpOwogICAgaWYgKGRlcHRoID09PSAwIHx8IGVtcHRpZXMubGVuZ3RoID09PSAwKSByZXR1cm4gaGV1cmlzdGljKGJvYXJkLHsgc25ha2VXZWlnaHRzLCBzbmFrZVdlaWdodEZhY3RvciB9KTsKICAgIGNvbnN0IGtleSA9IGJvYXJkVG9LZXkoYm9hcmQpICsgJ3xkJyArIGRlcHRoICsgKGlzQ2hhbmNlPyAnfGMnOid8bScpOwogICAgaWYgKFRULmhhcyhrZXkpKSByZXR1cm4gVFQuZ2V0KGtleSk7CgogICAgaWYgKGlzQ2hhbmNlKXsKICAgICAgICBsZXQgY2hvc2VuID0gZW1wdGllczsKICAgICAgICBpZiAoZW1wdGllcy5sZW5ndGggPiBERUZBVUxUUy5jaGFuY2VTYW1wbGVUaHJlc2hvbGQpIGNob3NlbiA9IHNhbXBsZUVtcHRpZXMoZW1wdGllcywgREVGQVVMVFMuY2hhbmNlU2FtcGxlQ291bnQsIGJvYXJkLCBiID0+IGhldXJpc3RpYyhiLHtzbmFrZVdlaWdodHMsc25ha2VXZWlnaHRGYWN0b3J9KSk7CiAgICAgICAgbGV0IHRvdGFsID0gMDsKICAgICAgICBmb3IgKGxldCBpPTA7aTxjaG9zZW4ubGVuZ3RoO2krKyl7CiAgICAgICAgICAgIGNvbnN0IFtyLGNdPWNob3NlbltpXTsKICAgICAgICAgICAgYm9hcmRbcl1bY109MjsKICAgICAgICAgICAgY29uc3QgdjIgPSBleHBlY3RpbWF4KGJvYXJkLCBkZXB0aC0xLCBmYWxzZSwgdHN0YXJ0LCB0aW1lQnVkZ2V0TXMsIHNuYWtlV2VpZ2h0cywgc25ha2VXZWlnaHRGYWN0b3IpOwogICAgICAgICAgICBpZiAodjIgPT09IG51bGwpIHsgYm9hcmRbcl1bY109bnVsbDsgcmV0dXJuIG51bGw7IH0KICAgICAgICAgICAgYm9hcmRbcl1bY109NDsKICAgICAgICAgICAgY29uc3QgdjQgPSBleHBlY3RpbWF4KGJvYXJkLCBkZXB0aC0xLCBmYWxzZSwgdHN0YXJ0LCB0aW1lQnVkZ2V0TXMsIHNuYWtlV2VpZ2h0cywgc25ha2VXZWlnaHRGYWN0b3IpOwogICAgICAgICAgICBpZiAodjQgPT09IG51bGwpIHsgYm9hcmRbcl1bY109bnVsbDsgcmV0dXJuIG51bGw7IH0KICAgICAgICAgICAgYm9hcmRbcl1bY109bnVsbDsKICAgICAgICAgICAgdG90YWwgKz0gMC45ICogdjIgKyAwLjEgKiB2NDsKICAgICAgICAgICAgaWYgKHBlcmZvcm1hbmNlLm5vdygpIC0gdHN0YXJ0ID4gdGltZUJ1ZGdldE1zKSByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgY29uc3QgYXZnID0gdG90YWwgLyBjaG9zZW4ubGVuZ3RoOwogICAgICAgIFRULnNldChrZXksIGF2Zyk7CiAgICAgICAgcmV0dXJuIGF2ZzsKICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgY2FuZCA9IFtdOwogICAgICAgIGZvciAobGV0IGk9MDtpPE1PVkVTLmxlbmd0aDtpKyspewogICAgICAgICAgICBjb25zdCBtID0gTU9WRVNbaV07CiAgICAgICAgICAgIGNvbnN0IHsgYm9hcmQ6IG5iLCBtb3ZlZCB9ID0gbW92ZU9uKGJvYXJkLCBtKTsKICAgICAgICAgICAgaWYgKCFtb3ZlZCkgY29udGludWU7CiAgICAgICAgICAgIGNhbmQucHVzaCh7IG0sIHE6IGhldXJpc3RpYyhuYix7c25ha2VXZWlnaHRzLHNuYWtlV2VpZ2h0RmFjdG9yfSksIG5iIH0pOwogICAgICAgIH0KICAgICAgICBpZiAoY2FuZC5sZW5ndGggPT09IDApIHsgY29uc3QgaCA9IGhldXJpc3RpYyhib2FyZCx7c25ha2VXZWlnaHRzLHNuYWtlV2VpZ2h0RmFjdG9yfSk7IFRULnNldChrZXksaCk7IHJldHVybiBoOyB9CiAgICAgICAgY2FuZC5zb3J0KChhLGIpPT5iLnEtYS5xKTsKICAgICAgICBsZXQgYmVzdCA9IC1JbmZpbml0eTsKICAgICAgICBmb3IgKGxldCBpPTA7aTxjYW5kLmxlbmd0aDtpKyspewogICAgICAgICAgICBjb25zdCB2ID0gZXhwZWN0aW1heChjYW5kW2ldLm5iLCBkZXB0aC0xLCB0cnVlLCB0c3RhcnQsIHRpbWVCdWRnZXRNcywgc25ha2VXZWlnaHRzLCBzbmFrZVdlaWdodEZhY3Rvcik7CiAgICAgICAgICAgIGlmICh2ID09PSBudWxsKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKHYgPiBiZXN0KSBiZXN0ID0gdjsKICAgICAgICAgICAgaWYgKHBlcmZvcm1hbmNlLm5vdygpIC0gdHN0YXJ0ID4gdGltZUJ1ZGdldE1zKSByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgVFQuc2V0KGtleSwgYmVzdCk7CiAgICAgICAgcmV0dXJuIGJlc3Q7CiAgICB9Cn0KCmZ1bmN0aW9uIGZpbmRCZXN0TW92ZShib2FyZCwgZGVwdGgsIHNuYWtlQ29ybmVyPSdicicsIHNuYWtlV2VpZ2h0RmFjdG9yPURFRkFVTFRTLnNuYWtlV2VpZ2h0RmFjdG9yLCB0aW1lQnVkZ2V0TXM9REVGQVVMVFMudGltZVBlck1vdmUpewogICAgY29uc3QgdHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICBjb25zdCBzbmFrZVdlaWdodHMgPSBtYWtlU25ha2VXZWlnaHRzKHNuYWtlQ29ybmVyKTsKICAgIFRULmNsZWFyICYmIFRULmNsZWFyKCk7CiAgICBsZXQgYmVzdE1vdmU9bnVsbDsgbGV0IGJlc3RTY29yZT0tSW5maW5pdHk7CiAgICBjb25zdCBtaW5EZXB0aCA9IE1hdGgubWF4KDEsIE1hdGgubWluKDIsIGRlcHRoKSk7CiAgICBjb25zdCBtYXhEID0gTWF0aC5taW4oZGVwdGgsIERFRkFVTFRTLm1heERlcHRoKTsKICAgIGZvciAobGV0IGQ9bWluRGVwdGg7IGQ8PW1heEQ7IGQrKyl7CiAgICAgICAgaWYgKHBlcmZvcm1hbmNlLm5vdygpIC0gdHN0YXJ0ID4gdGltZUJ1ZGdldE1zKSBicmVhazsKICAgICAgICBjb25zdCBtb3ZlQ2FuZGlkYXRlcyA9IE1PVkVTLm1hcChtPT57IGNvbnN0IHtib2FyZDpuYiwgbW92ZWR9ID0gbW92ZU9uKGJvYXJkLG0pOyBpZighbW92ZWQpIHJldHVybiBudWxsOyByZXR1cm4ge20sIHNjOiBoZXVyaXN0aWMobmIse3NuYWtlV2VpZ2h0cyxzbmFrZVdlaWdodEZhY3Rvcn0pfTsgfSkuZmlsdGVyKEJvb2xlYW4pLnNvcnQoKGEsYik9PmIuc2MtYS5zYykubWFwKHg9PngubSk7CiAgICAgICAgaWYgKG1vdmVDYW5kaWRhdGVzLmxlbmd0aCA9PT0gMCkgYnJlYWs7CiAgICAgICAgbGV0IGxvY2FsQmVzdD1udWxsOyBsZXQgbG9jYWxCZXN0U2NvcmU9LUluZmluaXR5OwogICAgICAgIGZvciAobGV0IGk9MDtpPG1vdmVDYW5kaWRhdGVzLmxlbmd0aDtpKyspewogICAgICAgICAgICBjb25zdCBkaXIgPSBtb3ZlQ2FuZGlkYXRlc1tpXTsKICAgICAgICAgICAgY29uc3QgeyBib2FyZDogbmIsIG1vdmVkIH0gPSBtb3ZlT24oYm9hcmQsIGRpcik7CiAgICAgICAgICAgIGlmICghbW92ZWQpIGNvbnRpbnVlOwogICAgICAgICAgICBjb25zdCB2YWwgPSBleHBlY3RpbWF4KG5iLCBkLTEsIHRydWUsIHRzdGFydCwgdGltZUJ1ZGdldE1zLCBzbmFrZVdlaWdodHMsIHNuYWtlV2VpZ2h0RmFjdG9yKTsKICAgICAgICAgICAgaWYgKHZhbCA9PT0gbnVsbCkgYnJlYWs7CiAgICAgICAgICAgIGlmICh2YWwgPiBsb2NhbEJlc3RTY29yZSl7IGxvY2FsQmVzdFNjb3JlID0gdmFsOyBsb2NhbEJlc3QgPSBkaXI7IH0KICAgICAgICAgICAgaWYgKHBlcmZvcm1hbmNlLm5vdygpIC0gdHN0YXJ0ID4gdGltZUJ1ZGdldE1zKSBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKGxvY2FsQmVzdCAhPSBudWxsKXsgYmVzdE1vdmUgPSBsb2NhbEJlc3Q7IGJlc3RTY29yZSA9IGxvY2FsQmVzdFNjb3JlOyB9CiAgICAgICAgaWYgKHBlcmZvcm1hbmNlLm5vdygpIC0gdHN0YXJ0ID4gdGltZUJ1ZGdldE1zKSBicmVhazsKICAgIH0KICAgIHdpbmRvdy5sYXN0RXZhbFNjb3JlID0gYmVzdFNjb3JlID09PSAtSW5maW5pdHkgPyBudWxsIDogYmVzdFNjb3JlOwogICAgcmV0dXJuIHsgYmVzdE1vdmUsIGJlc3RTY29yZSB9Owp9CgovKiAtLS0tLS0tLS0tIEtFWSBESVNQQVRDSCAtLS0tLS0tLS0tICovCmZ1bmN0aW9uIHNlbmRLZXlBY3Rpb24oZGlyKXsKICAgIGNvbnN0IG1hcCA9IHsgbGVmdDonQXJyb3dMZWZ0JywgcmlnaHQ6J0Fycm93UmlnaHQnLCB1cDonQXJyb3dVcCcsIGRvd246J0Fycm93RG93bicgfTsKICAgIGNvbnN0IGtleSA9IG1hcFtkaXJdOwogICAgaWYgKCFrZXkpIHJldHVybjsKICAgIGNvbnN0IGNvZGUgPSBrZXk9PT0nQXJyb3dMZWZ0Jz8zNzoga2V5PT09J0Fycm93VXAnPzM4OiBrZXk9PT0nQXJyb3dSaWdodCc/Mzk6NDA7CiAgICBjb25zdCBldiA9IG5ldyBLZXlib2FyZEV2ZW50KCdrZXlkb3duJyx7IGtleSwgY29kZSwga2V5Q29kZTpjb2RlLCB3aGljaDpjb2RlLCBidWJibGVzOnRydWUsIGNhbmNlbGFibGU6dHJ1ZSB9KTsKICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoZXYpOwogICAgc2V0VGltZW91dCgoKT0+eyBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KG5ldyBLZXlib2FyZEV2ZW50KCdrZXl1cCcseyBrZXksIGNvZGUsIGtleUNvZGU6Y29kZSwgd2hpY2g6Y29kZSwgYnViYmxlczp0cnVlIH0pKTsgfSwgOCk7Cn0KCi8qIC0tLS0tLS0tLS0gUmVtb3ZlZCBvbGQgYmlnIHJlZCBidXR0b24gY3JlYXRpb24gKHdlIGhpZGUgbGVnYWN5IGJ1dHRvbikgLS0tLS0tLS0tLSAqLwpmdW5jdGlvbiBtYWtlQnV0dG9uKCl7IC8qIG5vLW9wIHRvIGF2b2lkIG9sZCBVSSBkdXBsaWNhdGlvbiAqLyByZXR1cm4gbnVsbDsgfQoKLyogLS0tLS0tLS0tLSBBVVRPIExPT1AgKyBGYWxsYmFja3MgLS0tLS0tLS0tLSAqLwpsZXQgYXV0b0ludGVydmFsID0gbnVsbDsKbGV0IHJ1bm5pbmcgPSBmYWxzZTsKbGV0IGxhc3RCb2FyZEtleSA9IG51bGw7CmxldCBzdGFnbmF0aW9uQ291bnQgPSAwOwoKZnVuY3Rpb24gZmFsbGJhY2tTbmFrZUFjdGlvbihwcmVmZXJyZWRDb3JuZXI9J2JyJyl7CiAgICBjb25zdCBzZXFNYXAgPSB7CiAgICAgICAgdGw6IFsndXAnLCdsZWZ0JywncmlnaHQnLCdkb3duJ10sCiAgICAgICAgdHI6IFsndXAnLCdyaWdodCcsJ2xlZnQnLCdkb3duJ10sCiAgICAgICAgYnI6IFsnZG93bicsJ3JpZ2h0JywnbGVmdCcsJ3VwJ10sCiAgICAgICAgYmw6IFsnZG93bicsJ2xlZnQnLCdyaWdodCcsJ3VwJ10KICAgIH07CiAgICBjb25zdCBzZXEgPSBzZXFNYXBbcHJlZmVycmVkQ29ybmVyXSB8fCBzZXFNYXAuYnI7CiAgICBjb25zdCBwaWNrID0gc2VxW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSpzZXEubGVuZ3RoKV07CiAgICBzZW5kS2V5QWN0aW9uKHBpY2spOwogICAgcmV0dXJuIHBpY2s7Cn0KCmZ1bmN0aW9uIHN0YXJ0QXV0bygpewogICAgaWYgKGF1dG9JbnRlcnZhbCkgcmV0dXJuOwogICAgcnVubmluZyA9IHRydWU7CiAgICBsYXN0Qm9hcmRLZXkgPSBudWxsOwogICAgc3RhZ25hdGlvbkNvdW50ID0gMDsKICAgIGF1dG9JbnRlcnZhbCA9IHNldEludGVydmFsKCgpPT57CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgYm9hcmQgPSByZWFkQm9hcmRGcm9tRE9NKCk7CiAgICAgICAgICAgIGNvbnN0IHJlYWRGYWlsZWQgPSBib2FyZC5mbGF0KCkuZXZlcnkodj0+dj09PW51bGwpOwogICAgICAgICAgICBjb25zdCBub25FbXB0eSA9IGJvYXJkLmZsYXQoKS5maWx0ZXIoQm9vbGVhbik7CiAgICAgICAgICAgIGlmICghbm9uRW1wdHkubGVuZ3RoICYmIHJlYWRGYWlsZWQpIHsgZmFsbGJhY2tTbmFrZUFjdGlvbignYnInKTsgcmV0dXJuOyB9CgogICAgICAgICAgICBjb25zdCBhZGFwdGl2ZUNvcm5lciA9IGRldGVjdFByZWZlcnJlZENvcm5lcihib2FyZCkgfHwgJ2JyJzsKICAgICAgICAgICAgY29uc3Qgc25ha2VXZWlnaHRzID0gbWFrZVNuYWtlV2VpZ2h0cyhhZGFwdGl2ZUNvcm5lcik7CgogICAgICAgICAgICBpZiAocmVhZEZhaWxlZCkgewogICAgICAgICAgICAgICAgY29uc3QgbXYgPSBmYWxsYmFja1NuYWtlQWN0aW9uKGFkYXB0aXZlQ29ybmVyKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5sYXN0TW92ZSA9IG12OwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBrZXlOb3cgPSBib2FyZFRvS2V5KGJvYXJkKTsKICAgICAgICAgICAgaWYgKGtleU5vdyA9PT0gbGFzdEJvYXJkS2V5KSBzdGFnbmF0aW9uQ291bnQrKzsgZWxzZSB7IHN0YWduYXRpb25Db3VudCA9IDA7IGxhc3RCb2FyZEtleSA9IGtleU5vdzsgfQogICAgICAgICAgICBpZiAoc3RhZ25hdGlvbkNvdW50ID4gMykgewogICAgICAgICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbGwgPSBbJ3VwJywncmlnaHQnLCdkb3duJywnbGVmdCddOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBhbGxbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKmFsbC5sZW5ndGgpXTsKICAgICAgICAgICAgICAgICAgICBzZW5kS2V5QWN0aW9uKHIpOwogICAgICAgICAgICAgICAgICAgIHN0YWduYXRpb25Db3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgd2luZG93Lmxhc3RNb3ZlID0gcjsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IHsgYmVzdE1vdmUsIGJlc3RTY29yZSB9ID0gZmluZEJlc3RNb3ZlKGJvYXJkLCBERUZBVUxUUy5kZXB0aCwgYWRhcHRpdmVDb3JuZXIsIERFRkFVTFRTLnNuYWtlV2VpZ2h0RmFjdG9yLCBERUZBVUxUUy50aW1lUGVyTW92ZSk7CiAgICAgICAgICAgIGlmICghYmVzdE1vdmUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG12ID0gZmFsbGJhY2tTbmFrZUFjdGlvbihhZGFwdGl2ZUNvcm5lcik7CiAgICAgICAgICAgICAgICB3aW5kb3cubGFzdE1vdmUgPSBtdjsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZW5kS2V5QWN0aW9uKGJlc3RNb3ZlKTsKICAgICAgICAgICAgd2luZG93Lmxhc3RNb3ZlID0gYmVzdE1vdmU7CgogICAgICAgIH0gY2F0Y2goZSl7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0F1dG8gbG9vcCBlcnJvcicsIGUpOwogICAgICAgIH0KICAgIH0sIERFRkFVTFRTLm1vdmVJbnRlcnZhbCk7CiAgICBjb25zb2xlLmxvZygnJWNOQVogQVVUTyBTVEFSVEVEJywgJ2NvbG9yOmxpbWU7Zm9udC13ZWlnaHQ6NzAwJyk7Cn0KCmZ1bmN0aW9uIHN0b3BBdXRvKCl7CiAgICBpZiAoYXV0b0ludGVydmFsKSB7IGNsZWFySW50ZXJ2YWwoYXV0b0ludGVydmFsKTsgYXV0b0ludGVydmFsPW51bGw7IH0KICAgIHJ1bm5pbmc9ZmFsc2U7CiAgICBjb25zb2xlLmxvZygnJWNOQVogQVVUTyBTVE9QUEVEJywgJ2NvbG9yOm9yYW5nZScpOwogICAgd2luZG93Lmxhc3RNb3ZlID0gbnVsbDsKfQoKLyogLS0tLS0tLS0tLSBFeHBvc2UgQVBJIC0tLS0tLS0tLS0gKi8Kd2luZG93LlREMjA0OFVMVFJBID0gewogICAgc3RhcnQ6IHN0YXJ0QXV0bywKICAgIHN0b3A6IHN0b3BBdXRvLAogICAgc2V0RGVwdGg6IChkKT0+eyBERUZBVUxUUy5kZXB0aCA9IE1hdGgubWF4KDEsIE1hdGgubWluKDYsIHBhcnNlSW50KGQsMTApfHwzKSk7IGNvbnNvbGUubG9nKCdkZXB0aD0nLERFRkFVTFRTLmRlcHRoKTsgfSwKICAgIHNldFRpbWVQZXJNb3ZlOiAobXMpPT57IERFRkFVTFRTLnRpbWVQZXJNb3ZlID0gTWF0aC5tYXgoNTAsIHBhcnNlSW50KG1zLDEwKXx8MjAwKTsgY29uc29sZS5sb2coJ3RpbWVQZXJNb3ZlPScsREVGQVVMVFMudGltZVBlck1vdmUpOyB9LAogICAgc2V0TW92ZUludGVydmFsOiAobXMpPT57IERFRkFVTFRTLm1vdmVJbnRlcnZhbCA9IE1hdGgubWF4KDIwLCBwYXJzZUludChtcywxMCl8fDEyMCk7IGNvbnNvbGUubG9nKCdtb3ZlSW50ZXJ2YWw9JyxERUZBVUxUUy5tb3ZlSW50ZXJ2YWwpOyB9LAogICAgc2V0U25ha2VXZWlnaHQ6ICh3KT0+eyBERUZBVUxUUy5zbmFrZVdlaWdodEZhY3RvciA9IE1hdGgubWF4KDAsIHBhcnNlSW50KHcsMTApfHwyMDAwKTsgY29uc29sZS5sb2coJ3NuYWtlV2VpZ2h0PScsREVGQVVMVFMuc25ha2VXZWlnaHRGYWN0b3IpOyB9LAogICAgaXNSdW5uaW5nOiAoKT0+cnVubmluZwp9OwoKLyogPT09PT09PT09PSBOQVogVUk6IEN5YmVycHVuayBQYW5lbCArIEZQUyArIEV2YWwgQ2hhcnQgPT09PT09PT09PSAqLwooZnVuY3Rpb24gY3JlYXRlTmF6VUkoKXsKICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibmF6LXBhbmVsLXJvb3QiKSkgcmV0dXJuOwoKICAgIC8vIEZQUyB0cmFja2luZwogICAgbGV0IGxhc3RGcmFtZSA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgZnVuY3Rpb24gZnBzTG9vcCgpewogICAgICAgIGNvbnN0IG5vdyA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGNvbnN0IGZwcyA9IDEwMDAgLyBNYXRoLm1heCgxLCAobm93IC0gbGFzdEZyYW1lKSk7CiAgICAgICAgbGFzdEZyYW1lID0gbm93OwogICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5hei1mcHMiKTsKICAgICAgICBpZiAoZWwpIGVsLnRleHRDb250ZW50ID0gZnBzLnRvRml4ZWQoMSk7CiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZwc0xvb3ApOwogICAgfQogICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZwc0xvb3ApOwoKICAgIC8vIEV2YWwgaGlzdG9yeQogICAgY29uc3QgZXZhbEhpc3RvcnkgPSBbXTsKICAgIGZ1bmN0aW9uIHB1c2hFdmFsKHYpewogICAgICAgIGlmICh2ID09IG51bGwgfHwgIWlzRmluaXRlKHYpKSByZXR1cm47CiAgICAgICAgZXZhbEhpc3RvcnkucHVzaCh2KTsKICAgICAgICBpZiAoZXZhbEhpc3RvcnkubGVuZ3RoID4gNDgpIGV2YWxIaXN0b3J5LnNoaWZ0KCk7CiAgICB9CiAgICBzZXRJbnRlcnZhbCgoKT0+eyBpZiAod2luZG93Lmxhc3RFdmFsU2NvcmUgIT0gbnVsbCkgcHVzaEV2YWwod2luZG93Lmxhc3RFdmFsU2NvcmUpOyBkcmF3RXZhbCgpOyB9LCAxNTApOwoKICAgIC8vIFBhbmVsIERPTQogICAgY29uc3Qgcm9vdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgcm9vdC5pZCA9ICJuYXotcGFuZWwtcm9vdCI7CiAgICByb290LmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJuYXotaGVhZGVyIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF6LXRpdGxlIj5OQVogQVVUTyBWMS4wLjA8L2Rpdj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0ibmF6LWNvbGxhcHNlIj5cdTIyMTI8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJuYXotYm9keSI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hei1yb3ciPjxkaXY+RlBTPC9kaXY+PGRpdiBpZD0ibmF6LWZwcyI+MDwvZGl2PjwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXotcm93Ij48ZGl2Pkxhc3QgTW92ZTwvZGl2PjxkaXYgaWQ9Im5hei1sYXN0bW92ZSI+XHUyMDE0PC9kaXY+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hei1yb3ciPjxkaXY+QUkgRXZhbDwvZGl2PjxkaXYgaWQ9Im5hei1ldmFsIj5cdTIwMTQ8L2Rpdj48L2Rpdj4KICAgICAgICAgICAgPGNhbnZhcyBpZD0ibmF6LWV2YWwtY2FudmFzIiB3aWR0aD0iMjYwIiBoZWlnaHQ9IjgwIj48L2NhbnZhcz4KICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDo4cHg7Ij4KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9Im5hei1zdGFydCIgY2xhc3M9Im5hei1idG4iPlNUQVJUPC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJuYXotc3RvcCIgY2xhc3M9Im5hei1idG4gc3RvcCI+U1RPUDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHJvb3QpOwovLyBmb290ZXIgdGV4dApjb25zdCBmb290ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKZm9vdGVyLmNsYXNzTmFtZSA9ICduYXotZm9vdGVyJzsKZm9vdGVyLnRleHRDb250ZW50ID0gJ1x1MDBBOUFkbWluaXN0cmF0b3JcdTAwQTBIdVx1MDEyQmh1XHUwMEUxbmcgSGcnOwpyb290LmFwcGVuZENoaWxkKGZvb3Rlcik7CgoKICAgIC8vIFN0eWxlcwogICAgY29uc3QgY3NzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKICAgIGNzcy50ZXh0Q29udGVudCA9IGAKICAgICAgICAjbmF6LXBhbmVsLXJvb3QgewogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICAgICAgICAgIHJpZ2h0OiAyMHB4OwogICAgICAgICAgICB0b3A6IDIwcHg7CiAgICAgICAgICAgIHdpZHRoOiAyODBweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgcmdiYSg2LDgsMjAsMC45NSksIHJnYmEoMTIsOCwyOCwwLjg1KSk7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwyMzQsMjU1LDAuOSk7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMCAxOHB4IHJnYmEoMCwyMzQsMjU1LDAuMDgpLCBpbnNldCAwIDAgMTJweCByZ2JhKDAsMCwwLDAuNik7CiAgICAgICAgICAgIGNvbG9yOiAjMDBlYWZmOwogICAgICAgICAgICBmb250LWZhbWlseTogJ0NvbnNvbGFzJywgbW9ub3NwYWNlOwogICAgICAgICAgICB6LWluZGV4OiAyMTQ3NDgzNjQ3OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgICAgICAgICB1c2VyLXNlbGVjdDogbm9uZTsKICAgICAgICAgICAgcGFkZGluZzogMDsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICB9CiAgICAgICAgLm5hei1oZWFkZXIgewogICAgICAgICAgICBkaXNwbGF5OmZsZXg7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgICAgICAgIHBhZGRpbmc6MTBweDsKICAgICAgICAgICAgY3Vyc29yOm1vdmU7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206MXB4IHNvbGlkIHJnYmEoMCwyMzQsMjU1LDAuMDgpOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMCwwLDAsMC4yKSwgcmdiYSgwLDIzNCwyNTUsMC4wMikpOwogICAgICAgIH0KICAgICAgICAubmF6LXRpdGxlIHsgZm9udC13ZWlnaHQ6NzAwOyBmb250LXNpemU6MTRweDsgdGV4dC1zaGFkb3c6IDAgMCA4cHggcmdiYSgwLDIzNCwyNTUsMC4xNSk7IH0KICAgICAgICAjbmF6LWNvbGxhcHNlIHsKICAgICAgICAgICAgYmFja2dyb3VuZDp0cmFuc3BhcmVudDsgYm9yZGVyOjFweCBzb2xpZCByZ2JhKDAsMjM0LDI1NSwwLjIpOyBjb2xvcjojMDBlYWZmOyBwYWRkaW5nOjRweCA4cHg7IGJvcmRlci1yYWRpdXM6NnB4OyBjdXJzb3I6cG9pbnRlcjsKICAgICAgICB9CiAgICAgICAgLm5hei1ib2R5IHsgcGFkZGluZzoxMHB4OyB9CiAgICAgICAgLm5hei1yb3cgeyBkaXNwbGF5OmZsZXg7IGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOyBmb250LXNpemU6MTNweDsgbWFyZ2luLWJvdHRvbTo2cHg7IH0KICAgICAgICAjbmF6LWV2YWwtY2FudmFzIHsgd2lkdGg6MTAwJTsgaGVpZ2h0OjgwcHg7IGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4yNSk7IGJvcmRlci1yYWRpdXM6NnB4OyBib3JkZXI6MXB4IHNvbGlkIHJnYmEoMCwyMzQsMjU1LDAuMDYpOyBkaXNwbGF5OmJsb2NrOyB9CiAgICAgICAgLm5hei1idG4geyB3aWR0aDo0OSU7IHBhZGRpbmc6OHB4OyBtYXJnaW4tcmlnaHQ6MiU7IGJvcmRlci1yYWRpdXM6NnB4OyBib3JkZXI6MXB4IHNvbGlkIHJnYmEoMCwyMzQsMjU1LDAuNik7IGJhY2tncm91bmQ6dHJhbnNwYXJlbnQ7IGNvbG9yOiMwMGVhZmY7IGN1cnNvcjpwb2ludGVyOyBmb250LXdlaWdodDo3MDA7IH0KICAgICAgICAubmF6LWJ0bi5zdG9wIHsgYm9yZGVyLWNvbG9yOiByZ2JhKDI1NSwwLDg1LDAuOCk7IGNvbG9yOiAjZmYwMDU1OyBtYXJnaW4tcmlnaHQ6MDsgfQogICAgCiAgICAubmF6LWZvb3RlciB7CiAgICAgICAgZm9udC1zaXplOiAxMXB4OwogICAgICAgIGNvbG9yOiByZ2JhKDAsMjM0LDI1NSwwLjYpOwogICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICBwYWRkaW5nOiA2cHggMTBweDsKICAgICAgICBib3JkZXItdG9wOiAxcHggc29saWQgcmdiYSgwLDIzNCwyNTUsMC4wNCk7CiAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgcmdiYSgyNTUsMjU1LDI1NSwwLjAxKSwgcmdiYSgwLDAsMCwwLjAyKSk7CiAgICB9CmA7CiAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGNzcyk7CgogICAgLy8gRHJhZ2dpbmcKICAgIHJvb3Qub25tb3VzZWRvd24gPSBmdW5jdGlvbihlKXsKICAgICAgICBpZiAoIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygibmF6LWhlYWRlciIpICYmICFlLnRhcmdldC5jbG9zZXN0KCIubmF6LWhlYWRlciIpKSByZXR1cm47CiAgICAgICAgY29uc3QgcmVjdCA9IHJvb3QuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgY29uc3Qgc2hpZnRYID0gZS5jbGllbnRYIC0gcmVjdC5sZWZ0OwogICAgICAgIGNvbnN0IHNoaWZ0WSA9IGUuY2xpZW50WSAtIHJlY3QudG9wOwogICAgICAgIGZ1bmN0aW9uIG1vdmUoZXYpeyByb290LnN0eWxlLmxlZnQgPSAoZXYucGFnZVggLSBzaGlmdFgpICsgInB4Ijsgcm9vdC5zdHlsZS50b3AgPSAoZXYucGFnZVkgLSBzaGlmdFkpICsgInB4Ijsgcm9vdC5zdHlsZS5yaWdodCA9ICJhdXRvIjsgfQogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIG1vdmUpOwogICAgICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9ICgpPT4gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgbW92ZSk7CiAgICB9OwoKICAgIC8vIENvbGxhcHNlCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibmF6LWNvbGxhcHNlIikub25jbGljayA9ICgpPT57CiAgICAgICAgY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNuYXotcGFuZWwtcm9vdCAubmF6LWJvZHkiKTsKICAgICAgICBpZiAoIWJvZHkpIHJldHVybjsKICAgICAgICBib2R5LnN0eWxlLmRpc3BsYXkgPSAoYm9keS5zdHlsZS5kaXNwbGF5ID09PSAibm9uZSIpID8gImJsb2NrIiA6ICJub25lIjsKICAgIH07CgogICAgLy8gQnV0dG9ucyB3aXJpbmcKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJuYXotc3RhcnQiKS5vbmNsaWNrID0gKCk9PnsgaWYgKHdpbmRvdy5URDIwNDhVTFRSQSkgVEQyMDQ4VUxUUkEuc3RhcnQoKTsgfTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJuYXotc3RvcCIpLm9uY2xpY2sgPSAoKT0+eyBpZiAod2luZG93LlREMjA0OFVMVFJBKSBURDIwNDhVTFRSQS5zdG9wKCk7IH07CgogICAgLy8gVXBkYXRlIGxhc3QgbW92ZSAmIGV2YWwgaW4gVUkKICAgIHNldEludGVydmFsKCgpPT57CiAgICAgICAgY29uc3QgbG0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibmF6LWxhc3Rtb3ZlIik7IGlmIChsbSkgbG0udGV4dENvbnRlbnQgPSAod2luZG93Lmxhc3RNb3ZlIHx8ICdcdTIwMTQnKTsKICAgICAgICBjb25zdCBldiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJuYXotZXZhbCIpOyBpZiAoZXYpIGV2LnRleHRDb250ZW50ID0gKHdpbmRvdy5sYXN0RXZhbFNjb3JlID09IG51bGwgPyAnXHUyMDE0JyA6IE1hdGgucm91bmQod2luZG93Lmxhc3RFdmFsU2NvcmUpKTsKICAgIH0sIDEyMCk7CgogICAgLy8gRHJhdyBldmFsdWF0aW9uIGdyYXBoCiAgICBmdW5jdGlvbiBkcmF3RXZhbCgpewogICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJuYXotZXZhbC1jYW52YXMiKTsKICAgICAgICBpZiAoIWNhbnZhcykgcmV0dXJuOwogICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgIGNvbnN0IHcgPSBjYW52YXMud2lkdGggPSAyNjA7CiAgICAgICAgY29uc3QgaCA9IGNhbnZhcy5oZWlnaHQgPSA4MDsKICAgICAgICBjdHguY2xlYXJSZWN0KDAsMCx3LGgpOwogICAgICAgIGlmIChldmFsSGlzdG9yeS5sZW5ndGggPCAyKSByZXR1cm47CiAgICAgICAgY29uc3QgbWF4ID0gTWF0aC5tYXgoLi4uZXZhbEhpc3RvcnkpOwogICAgICAgIGNvbnN0IG1pbiA9IE1hdGgubWluKC4uLmV2YWxIaXN0b3J5KTsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDI7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gIiMwMGVhZmYiOwogICAgICAgIGZvciAobGV0IGk9MDtpPGV2YWxIaXN0b3J5Lmxlbmd0aDtpKyspewogICAgICAgICAgICBjb25zdCB4ID0gKGkgLyAoZXZhbEhpc3RvcnkubGVuZ3RoIC0gMSkpICogKHcgLSA2KSArIDM7CiAgICAgICAgICAgIGNvbnN0IHYgPSBldmFsSGlzdG9yeVtpXTsKICAgICAgICAgICAgY29uc3Qgbm9ybSA9ICh2IC0gbWluKSAvIChtYXggLSBtaW4gKyAxZS02KTsKICAgICAgICAgICAgY29uc3QgeSA9IGggLSAobm9ybSAqIChoIC0gNikpIC0gMzsKICAgICAgICAgICAgaWYgKGk9PT0wKSBjdHgubW92ZVRvKHgseSk7IGVsc2UgY3R4LmxpbmVUbyh4LHkpOwogICAgICAgIH0KICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gcHVzaEV2YWwodil7CiAgICAgICAgaWYgKHYgPT0gbnVsbCB8fCAhaXNGaW5pdGUodikpIHJldHVybjsKICAgICAgICBldmFsSGlzdG9yeS5wdXNoKHYpOwogICAgICAgIGlmIChldmFsSGlzdG9yeS5sZW5ndGggPiA0OCkgZXZhbEhpc3Rvcnkuc2hpZnQoKTsKICAgIH0KCiAgICAvLyBwZXJpb2RpYyBldmFsIHB1c2gKICAgIHNldEludGVydmFsKCgpPT57IGlmICh3aW5kb3cubGFzdEV2YWxTY29yZSAhPSBudWxsKSB7IHB1c2hFdmFsKHdpbmRvdy5sYXN0RXZhbFNjb3JlKTsgZHJhd0V2YWwoKTsgfSB9LCAxNDApOwoKfSkoKTsKCi8qIC0tLS0tLS0tLS0gRmluYWwgbG9nIC0tLS0tLS0tLS0gKi8KY29uc29sZS5sb2coJyVjTkFaIEFVVE8gVjEuMC4wIGxvYWRlZCBcdTIwMTQgY2FsbCBURDIwNDhVTFRSQS5zdGFydCgpIG9yIHVzZSBOQVogcGFuZWwnLCAnY29sb3I6bGlnaHRibHVlO2ZvbnQtd2VpZ2h0OjcwMCcpOwoKfSkoKTs=";